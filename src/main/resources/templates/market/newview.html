<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/layout/newUserLayout}">

<div class="container" layout:fragment="content">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>farmPlus</title>
    <link rel="stylesheet" th:href="@{/newcss/mainStyle.css}">
    <script>
        window.onload = function(){
            // 플러스 버튼 클릭 시 수량 증가
            document.querySelector('.plus-btn').onclick = function() {
            //document.querySelector('.plus-btn').addEventListener('click', function() {
                const quantityInput = document.querySelector('.quantity');
                let value = parseInt(quantityInput.value);
                value = isNaN(value) ? 0 : value;
                quantityInput.value = value + 1;
                changePrice();
            };

            // 마이너스 버튼 클릭 시 수량 감소
            document.querySelector('.minus-btn').onclick = function() {
            //document.querySelector('.minus-btn').addEventListener('click', function() {
                const quantityInput = document.querySelector('.quantity');
                let value = parseInt(quantityInput.value);
                value = isNaN(value) ? 0 : value;
                if (value > 1) {
                    quantityInput.value = value - 1;
                }
                changePrice();
            };

            // 수량 변경시 합계 가격 변동 코드
            const count = document.getElementById('count');
            const totalPrice = document.getElementById('totalPrice');
            const price = document.getElementById('price');
            const finalPoint = document.getElementById('finalPoint');
            const finalPrice = document.getElementById('finalPrice');

            function changePrice() {
                // 할인 적용 금액
                let total = count.value * parseInt(price.innerText);
                totalPrice.innerText = total;
                // 적립 포인트
                let totalPoint = total / 10;
                finalPoint.innerText = totalPoint;
                // 최종 금액
                finalPrice.innerText = total;
            }
        }
    </script>

        <main class="articleMain">
            <div class="sideBox">
                <img th:src="@{/newimage/farm_market_logo.png}" alt="">
                <ul>
                    <li><a class="tabOn" href="">장보기</a></li>
                    <li><a href="">장바구니</a></li>
                    <li><a href="">배송조회</a></li>
                </ul>
            </div>

            <div class="contentBox">
                <div class="articleHeader">
                    <h2>장보기</h2>
                    <h5>HOME > 장보기 > <span>장보기</span></h5>
                </div>

                <div class="articleBox">
                    <h3>기본정보</h3>       
                    <div class="prodInfoBox">
                        <div class="prodImg">
                            <img th:src="@{'/imagePath/'+${productDTO.titleImg}}" th:alt="${productDTO.prodname}" alt="">
                        </div>

                        <div class="pordInfo">
                            <h2>
                                <span class="prodTitle">[[${productDTO.prodname}]]</span>
                                <span th:if="${productDTO.amount} >= 1000" th:text="(${productDTO.amount}/1000)+'kg'"></span>
                                <span th:if="${productDTO.amount} < 1000" th:text="${productDTO.amount}+'g'"></span>
                            </h2>
                            <h4><span>12000</span>건 리뷰></h4>
                            <h3><span id="discount">[[${productDTO.discount}]]</span>%</h3>
                            <h3>
                                <s >[[${productDTO.price}]]</s>원
                            </h3>
                            <h2><span id="price" th:text="${productDTO.price} - (${productDTO.price} * ${productDTO.discount} / 100 )"></span>원</h2>
                            <h5>(100g 당 <span th:text="(${productDTO.price} - (${productDTO.price} * ${productDTO.discount} / 100 ))/${productDTO.amount}*100"></span>원)</h5>
                            <h5>재고 <span>[[${productDTO.stock}]]</span>개</h5>
                            <h4>구매금액의 <span>10</span>% 팜포인트 적립 예정</h4>
                            <h3><span th:text="${#temporals.format(#temporals.createNow().plusDays(2), 'MM-dd')}"></span>도착 예정</h3>
                            
                            <div class="totalPriceBox">
                                <div class="totalPrice">
                                    <h4>
                                        <span class="prodTitle">[[${productDTO.prodname}]]</span>
                                        <span th:if="${productDTO.amount} >= 1000" th:text="(${productDTO.amount}/1000)+'kg'"></span>
                                        <span th:if="${productDTO.amount} < 1000" th:text="${productDTO.amount}+'g'"></span>
                                    </h4>
                                    <div class="quantity-input">
                                        <button class="minus-btn" type="button">-</button>
                                        <input type="text" class="quantity" name="count" min="1" value="1" id="count">
                                        <button class="plus-btn" type="button">+</button>
                                    </div>
                                    <h4><span id="totalPrice" th:text="${productDTO.price} - (${productDTO.price} * ${productDTO.discount} / 100 )"></span>원</h4>
                                </div>
                                <div class="priceFlex">
                                    <h3>적립예정포인트</h3>
                                    <h2><span id="finalPoint" th:text="(${productDTO.price} - (${productDTO.price} * ${productDTO.discount} / 100 )) / 10"></span>P</h2>
                                </div>
                                <div class="priceFlex">
                                    <h3>구매예정금액</h3>
                                    <h2><span id="finalPrice" th:text="${productDTO.price} - (${productDTO.price} * ${productDTO.discount} / 100 )"></span>원</h2>
                                </div>
                            </div>

                            <div class="prodBtn">
                                <button th:href="@{/market/cart}" id="btnCart">장바구니</button>
                                <button th:href="@{/market/cart}" id="btnOrder">바로구매</button>
                            </div>
                        </div>
                    </div>

                    <div class="prodContent">
                        <h3>상품설명</h3>
                        <img th:src="@{'/imagePath/'+${productDTO.contentImg}}" th:alt="${productDTO.prodname}">
                    </div>

                    <h3>배송정보</h3>
                    <div class="delivery">
                        <p>
                            입금하신 이후 택배송장번호는 SMS(문자서비스)를 통해 고객님께 안내해드립니다.
                        </p>
                    </div>
                    <h3>교환/반품</h3>
                    <div class="exchange">
                        <table border="0">
                            <tr>
                                <td>교환 반품이 가능한 경우</td>
                                <td>
                                    <ul>
                                        <li>팜스토리 상품에 하자가 있거나 불량인 경우</li>
                                        <li>채소, 과일, 양곡등의 식품은 만1일 이내</li>
                                        <li>기타 상품은 수령일로부터 영업일 기준 일주일 이내</li>
                                        <li>받으신 상품이 표시사항과 다른 경우에는 받으신 날로부터 일주일 이내</li>
                                    </ul>
                                </td>
                            </tr>
                            <tr>
                                <td>교환 반품이 불가능한 경우</td>
                                <td>
                                    <ul>
                                        <li>신선 식품의 경우 단순히 마음에 들지 않는 경우</li>
                                        <li>단순 변심으로 상품이 가치가 훼손돼서 판매가 어려운 경우</li>
                                    </ul>
                                </td>
                            </tr>
                        </table>
                    </div>
                                       
                </div>
            </div>
        </main>


    </div>

</html>