<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>팜스토리::장바구니</title>
    <link rel="stylesheet" href="../css/style.css"/>

    <script>
        window.onload = function () {

            const totalCount = document.getElementById('totalCount');
            const totalPrice = document.getElementById('totalPrice');
            const totalDiscount = document.getElementById('totalDiscount');
            const totalDelCost = document.getElementById('totalDelCost');
            const totalPoint = document.getElementById('totalPoint');
            const totalOrder = document.getElementById('totalOrder');

            const prodCheckBox = document.querySelector('.prodCheckBox');

        //// 페이지 로드시 가격 표시 ////
            const prodCount = document.getElementsByName('prodCount');
            const prodPoint = document.getElementsByName('prodPoint');
            const prodPrice = document.getElementsByName('prodPrice');
            const prodDisPrice = document.getElementsByName('prodDisPrice');
            const prodTotal = document.getElementsByName('prodTotal');
            // 각 품목 합계 total값들
            let totalProdCount = 0;
            let totalProdPrice = 0;
            let totalProdDisPrice = 0;
            let totalProdPoint = 0;
            let totalProdTotal = 0;

            // 각 포인트, 가격, 할인, 합계값 더하는 for문
            for (let i = 0; i < prodPoint.length; i++) {
                totalProdCount += 1;
                totalProdPoint += (parseInt(prodPoint[i].innerText) * parseInt(prodCount[i].value));
                totalProdDisPrice += (parseInt(prodPrice[i].innerText) - parseInt(prodDisPrice[i].innerText))* parseInt(prodCount[i].value);
                totalProdPrice += (parseInt(prodPrice[i].innerText) * parseInt(prodCount[i].value));
                totalProdTotal += parseInt(prodTotal[i].innerText);
            }
            // 태그에 값 출력하기
            totalCount.innerText = totalProdCount.toString();
            totalPrice.innerText = totalProdPrice.toString();
            totalDiscount.innerText = totalProdDisPrice.toString();
            totalPoint.innerText = totalProdPoint.toString();
            totalOrder.innerText = totalProdTotal.toString();

            // prodCheckBox를 체크할때마다 최종 가격 변동
            // prodCheckBox가 체크되어 있는 tr만 가지고와서 가격 포인트 할인 등등 더해서 밑에 보여주기


            document.addEventListener('click', function (e){
                if (e.target.className === "prodCheckBox"){
                    const checkBox = e.target;
                    const tr = checkBox.parentNode.parentNode;
                    if (checkBox.checked){
                        console.log("체크");
                        console.log(tr.querySelector('[name="prodPrice"]').innerText);
                    }else {
                        console.log("해제");
                    }
                }

            })
            const counts = document.getElementsByClassName('count');
            Array.from(counts).forEach(function(count) {
                count.addEventListener('input', function(e) {
                    alert(e.target.value);
                    
                });
            });

        }
    </script>

</head>
<body>
<div id="container">
    <header>
        <a href="../index.html" class="logo"><img src="../images/logo.png" alt="로고"/></a>
        <p>
            <a href="#">HOME |</a>
            <a href="#">로그인 |</a>
            <a href="#">회원가입 |</a>
            <a href="#">고객센터</a>
        </p>
        <img src="../images/head_txt_img.png" alt="3만원 이상 무료배송"/>

        <ul class="gnb">
            <li><a href="#">팜스토리소개</a></li>
            <li><a href="#"><img src="../images/head_menu_badge.png" alt="30%"/>장바구니</a></li>
            <li><a href="#">농작물이야기</a></li>
            <li><a href="#">이벤트</a></li>
            <li><a href="#">커뮤니티</a></li>
        </ul>
    </header>

    <div id="sub">
        <div><img src="../images/sub_top_tit2.png" alt="MARKET"></div>
        <section class="market">
            <aside>
                <img src="../images/sub_aside_cate2_tit.png" alt="장보기"/>

                <ul class="lnb">
                    <li class="on"><a href="./market.html">장보기</a></li>
                </ul>
            </aside>
            <article class="cart">
                <nav>
                    <img src="../images/sub_nav_tit_cate2_tit1.png" alt="장보기"/>
                    <p>
                        HOME > 장보기 > <em>장보기</em>
                    </p>
                </nav>

                <!-- 내용 시작 -->
                <p class="sort">
                    <a href="#" class="on">장바구니 전체(10)</a>
                </p>
                <table border="0">
                    <thead>
                    <tr>
                        <th>
                            <input type="checkbox" name="all">
                        </th>
                        <th>이미지</th>
                        <th>종류</th>
                        <th>상품명</th>
                        <th>무게</th>
                        <th>수량</th>
                        <th>할인</th>
                        <th>포인트</th>
                        <th>가격</th>
                        <th>소계</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:if="${productDTO} == null" class="empty">
                        <td colspan="9">장바구니에 상품이 없습니다.</td>
                    </tr>
                    <tr th:each="product : ${productDTO}">
                        <td>
                            <input type="checkbox" name="" class="prodCheckBox">
                        </td>
                        <td>
                            <a href="./productDetail.html"><img th:src="@{'/imagePath/'+${product.thumb}}" class="thumb" alt="사과 500g"></a>
                        </td>
                        <td>[[${product.cate}]]</td>
                        <td><a href="#">[[${product.prodname}]]</a></td>
                        <td>
                            <span th:if="${product.amount} >= 1000" th:text="(${product.amount}/1000)+'kg'"></span>
                            <span th:if="${product.amount} < 1000" th:text="${product.amount}+'g'"></span>
                        </td>
                        <td>
                            <input type="number" class="count" th:name="prodCount" th:value="${product.count}">
                        </td>
                        <td>[[${product.discount}]]%</td>
                        <td><span th:text="(${product.price}-(${product.price}*${product.discount}/100))*10/100" th:name="prodPoint"></span> P</td>
                        <td>
                            <span th:text="${product.price}-(${product.price}*${product.discount}/100)" th:name="prodDisPrice"></span> 원
                            <s><span th:text="${product.price}" th:name="prodPrice"></span></s> 원
                        </td>
                        <td><strong th:text="(${product.price}-(${product.price}*${product.discount}/100))*${product.count}" th:name="prodTotal"></strong>원</td>
                    </tr>


                    </tbody>
                </table>
                <input type="button" name="del" value="선택삭제">

                <div class="info">
                    <table border="0">
                        <caption>전체합계</caption>
                        <tr>
                            <th>상품수</th>
                            <td id="totalCount"></td>
                        </tr>
                        <tr>
                            <th>상품금액</th>
                            <td id="totalPrice"></td>
                        </tr>
                        <tr>
                            <th>할인금액</th>
                            <td id="totalDiscount"></td>
                        </tr>
                        <tr>
                            <th>배송비</th>
                            <td class="delivery" id="totalDelCost"></td>
                        </tr>
                        <tr>
                            <th>포인트</th>
                            <td id="totalPoint"></td>
                        </tr>
                        <tr>
                            <th>전체주문금액</th>
                            <td class="total" id="totalOrder"></td>
                        </tr>
                        </tr>
                    </table>
                    <a th:href="@{/user/login}" class="btnOrder">주문하기</a>
                </div>
                <!-- 내용 끝 -->

            </article>
        </section>

    </div>


    <footer>
        <img src="../images/footer_logo.png" alt="로고"/>
        <p>
            (주)팜스토리 / 사업자등록번호 123-45-67890 / 통신판매업신고 제 2013-팜스토리구-123호 / 벤처기업확인 서울지방중소기업청 제 012345678-9-01234호<br />
            등록번호 팜스토리01234 (2013.04.01) / 발행인 : 홍길동<br />
            대표 : 홍길동 / 이메일 : email@mail.mail / 전화 : 01) 234-5678 / 경기도 성남시 잘한다구 신난다동 345<br />
            <em>Copyright(C)홍길동 All rights reserved.</em>
        </p>
    </footer>
</div>
</body>
</html>